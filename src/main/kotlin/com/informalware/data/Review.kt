package com.informalware.data

import kotlinx.serialization.Serializable

const val MAX_SUMMARY_LENGTH: UInt = 20u

/**
 * Enum usada para definir a avaliação de uma `Review` sobre uma partida
 * */
@Serializable
enum class Rating {
    TERRIBLE,
    BAD,
    OK,
    GOOD,
    AMAZING
}

/**
 * Função utilitária para ordenar `Rating`s de reviews
 * TERRIBLE = 0
 * BAD = 1
 * OK = 2
 * GOOD = 3
 * AMAZING = 4
 * @return número entre 0 e 4 indicando o nível da partida
 * */
fun Rating.getOrder(): Int = when(this) {
    Rating.TERRIBLE -> 0
    Rating.BAD -> 1
    Rating.OK -> 2
    Rating.GOOD -> 3
    Rating.AMAZING -> 4
}

/**
 * Objeto que representa uma review de uma partida
 * @property id número de identificação da ID no banco de dados
 * @property matchId número de identificação da partida a qual essa review se refere
 * @property matchId número de identificação do usuário que escreveu essa review
 * @property rating avaliação quantitativa dada pelo usuário
 * @property review avaliação qualitativa escrita pelo usuário
 * */
@Serializable
data class Review(
    val id: UInt,
    val matchId: UInt,
    val userId: UInt,
    var rating: Rating,
    var review: String
) {
    /**
     * Método utilitário para obter um resumo da review escrita pelo usuário.
     * O tamanho do resumo por padrão é dado pela constante MAX_SUMMARY_LENGTH
     *
     * */
    fun getSummary(maxLength: UInt = MAX_SUMMARY_LENGTH): String {
        if (this.review.length.toUInt() < maxLength) {
            return this.review
        } else {
            val summary = this.review.substring(0, maxLength.toInt())
            return "$summary..."
        }
    }
}

