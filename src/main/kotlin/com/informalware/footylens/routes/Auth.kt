package com.informalware.footylens.routes

import com.informalware.footylens.data.LoginRequest
import com.informalware.footylens.plugins.authenticateUser
import com.informalware.footylens.plugins.connectFooty
import io.ktor.http.*
import io.ktor.server.application.*
import io.ktor.server.request.*
import io.ktor.server.response.*
import io.ktor.server.routing.*

fun Application.authRoutes(testing: Boolean = false) {
    routing {
        post("/login") {
            val login = call.receive<LoginRequest>()
            val database = connectFooty(testing)

            when (val id = database.authenticateUser(login)) {
                is Int -> call.respond(mapOf("userid" to id))
                else -> call.respond(HttpStatusCode.Unauthorized, mapOf("error" to "Wrong email or password"))
            }
        }
    }
}