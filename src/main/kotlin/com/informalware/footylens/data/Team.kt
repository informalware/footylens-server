package com.informalware.footylens.data

import kotlinx.serialization.Serializable
import org.ktorm.dsl.QueryRowSet
import org.ktorm.schema.*


/**
 * Objeto que representa um time armazenado no banco de dados.
 * @property id Identificador único do time.
 * @property name Nome do time.
 * @property league ID da liga a qual o time pertence.
 * */
@Serializable
data class Team(
    var id: Int,
    var name: String,
    var league: String
)

/**
 * Estrutura recebida pelo endpoint de registro para cadastrar um novo time.
 */
@Serializable
data class TeamRegistryRequest(
    val name: String,
    val league: String
)

/**
 * Table do Ktorm para os times
 */
object Teams : BaseTable<Team>("teams") {
    val id = int("id").primaryKey()
    val name = varchar("name")
    val league = varchar("league")

    override fun doCreateEntity(row: QueryRowSet, withReferences: Boolean): Team {
        return Team(
            id = row[id] ?: 0,
            name = row[name] ?: "",
            league = row[league] ?: ""
        )
    }
}

/**
 * Objeto que representa os seguidores de um time.
 * @property team_id ID do time seguido.
 * @property follower_id ID do usuário que segue o time.
 */
@Serializable
data class TeamFollows(
    val team_id: Int,
    val follower_id: Int
)

/**
 * Table do Ktorm para os seguidores de times.
 */
object TeamsFollows : BaseTable<TeamFollows>("teamfollows") {
    val team_id = int("team_id")
    val follower_id = int("follower_id")

    override fun doCreateEntity(row: QueryRowSet, withReferences: Boolean): TeamFollows {
        return TeamFollows(
            team_id = row[team_id] ?: 0,
            follower_id = row[follower_id] ?: 0
        )
    }
}