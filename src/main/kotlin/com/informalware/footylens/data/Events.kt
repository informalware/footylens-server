package com.informalware.footylens.data

import kotlinx.serialization.Serializable
import org.ktorm.dsl.QueryRowSet
import org.ktorm.schema.*

enum class EventTypes {
    YELLOW, RED, GOAL, PENALTY
}

/**
 * Objeto que representa eventos de uma partida
 * @property id Identificador único do evento.
 * @property event Tipo do evento.
 * @property moment Minutagem do evento na partida.
 * @property playerId Identificador do jogador que participou do evento.
 * @property matchId Identificador da partida onde o evento ocorreu.
 * @property teamId Identificador do moment do jogador envolvido no evento.
 * */
@Serializable
data class Event (
    val id: Int,
    val event: EventTypes,
    val moment: Int,
    val player: String,
    val matchId: Int,
    val teamId: Int
)

/**
 * Objeto que representa uma requisição de registro de evento
 * @property event Tipo do evento.
 * @property moment Minutagem do evento na partida.
 * @property player Identificador do jogador que participou do evento.
 * @property matchId Identificador da partida onde o evento ocorreu.
 * @property teamId Identificador do moment do jogador envolvido no evento.
 */
@Serializable
data class EventRegistryRequest(
    val event: EventTypes,
    val moment: Int,
    val player: String,
    val matchId: Int,
    val teamId: Int
)

object Events : BaseTable<Event>("events") {
    val id = int("id").primaryKey()
    val event = int("event")
    val moment = int("moment")
    val player = varchar("player")
    val matchId = int("match_id")
    val teamId = int("team_id")

    override fun doCreateEntity(row: QueryRowSet, withReferences: Boolean): Event {
        return Event(
            id = row[id] ?: 0,
            event = EventTypes.entries[row[event] ?: 0],
            moment = row[moment] ?: 0,
            player = row[player].orEmpty(),
            matchId = row[matchId] ?: 0,
            teamId = row[teamId] ?: 0
        )
    }
}


/**
 * Função para transformar um Enum em um Int
 * */
inline fun <reified T : Enum<T>> T.toInt(): Int {
    return this.ordinal
}
