package com.informalware.footylens.data

import com.informalware.footylens.data.util.DateSerializer
import kotlinx.serialization.Serializable
import java.util.*

/**
 * Objeto para representar um comentário em uma review
 * @property id identificador do comentário
 * @property reviewId identificador da review a qual o comentário se refere
 * @property commentary o comentário feito sobre a review
 * @property creationDate data da criação do comentário
 * @property lastModifiedDate data da última modificação do comentário
 * */
@Serializable
data class Commentary(
    val id: UInt,
    val reviewId: UInt,
    val userId: String,
    var commentary: String,
    @Serializable(with = DateSerializer::class)
    val creationDate: Date,
    @Serializable(with = DateSerializer::class)
    var lastModifiedDate: Date
) {
    fun getSummary(maxLength: UInt): String {
        return if (this.commentary.length.toUInt() < maxLength) {
            this.commentary
        } else {
            val summary = this.commentary.substring(0, maxLength.toInt())
            "$summary..."
        }
    }

    fun toSummarized(maxLength: UInt = MAX_SUMMARY_LENGTH.toUInt()): SummarizedCommentary = SummarizedCommentary(id, reviewId, userId, getSummary(maxLength))
}

@Serializable
data class SummarizedCommentary(
    val id: UInt,
    val reviewId: UInt,
    val userId: String,
    var commentary: String
)

@Serializable
data class CommentaryRegistryRequest(
    val reviewId: UInt,
    val userId: String,
    var commentary: String
)