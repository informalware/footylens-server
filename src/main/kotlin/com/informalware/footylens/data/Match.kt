package com.informalware.footylens.data

import kotlinx.serialization.Serializable
import org.ktorm.dsl.QueryRowSet
import org.ktorm.schema.*

import java.util.Date

/**
 * Objeto que representa uma partida, seja armazenada no banco de dados ou
 * recebida de uma requisição da API.
 * @property id Identificador único da partida.
 * @property home Nome do time mandante.
 * @property away Nome do time visitante.
 * @property scoreboard Estado atual da partida.
 * @property stats Estado atual da partida.
 * */
@Serializable
data class Match(
    val id: Int,
    val home: Int,
    val away: Int,
    val scoreboard: Pair<Int, Int>
)

/**
 * Estrutura recebida pelo endpoint de registro para cadastrar uma nova partida
 * @property home Nome do time mandante.
 * @property away Nome do time visitante.
 * @property scoreboard Estado atual da partida.
 */
@Serializable
data class MatchRegistryRequest(
    val home: Int,
    val away: Int,
    val scoreboard: Pair<Int, Int>
)

/**
 * Tabela do Ktorm para as partidas
 * */
object Matches : BaseTable<Match>("matches") {
    val id = int("id").primaryKey()
    val home = int("home")
    val away = int("away")
    val h_scoreboard = int("h_scoreboard")
    val v_scoreboard = int("v_scoreboard")

    override fun doCreateEntity(row: QueryRowSet, withReferences: Boolean): Match {
        return Match(
            id = row[id] ?: 0,
            home = row[home] ?: 0,
            away = row[away] ?: 0,
            scoreboard = Pair(row[h_scoreboard] ?: 0, row[v_scoreboard] ?: 0)
        )
    }
}

